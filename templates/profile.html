{% extends "base.html" %}

{% block content %}
<div class="profile-header">
    <div class="container">
        <h1>–í–∞—à –ø—Ä–æ—Ñ–∏–ª—å</h1>
        <p>–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å –≤ –æ–±—É—á–µ–Ω–∏–∏ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</p>
    </div>
</div>

<div class="profile-content">
    <div class="container">
        <div class="profile-grid">
            <div class="profile-sidebar">
                <div class="profile-card">
                    <div class="profile-avatar">
                        <div class="avatar-placeholder">
                            {{ user.username[0]|upper }}
                        </div>
                    </div>
                    <div class="profile-info">
                        <h2>{{ user.username }}</h2>
                        <p class="profile-email">{{ user.email }}</p>
                        <div class="profile-stats">
                            <div class="profile-stat">
                                <strong>{{ user.xp }}</strong>
                                <span>–í—Å–µ–≥–æ XP</span>
                            </div>
                            <div class="profile-stat">
                                <strong>{{ user.streak }}</strong>
                                <span>–î–Ω–µ–π –ø–æ–¥—Ä—è–¥</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="languages-card">
                    <h3>–Ø–∑—ã–∫–∏</h3>
                    <div class="language-item">
                        <strong>–ò–∑—É—á–∞—é:</strong>
                        <span>{{ user.target_language }}</span>
                    </div>
                    <div class="language-item">
                        <strong>–†–æ–¥–Ω–æ–π:</strong>
                        <span>{{ user.native_language }}</span>
                    </div>
                </div>

                <div class="account-card">
                    <h3>–ê–∫–∫–∞—É–Ω—Ç</h3>
                    <p>–£—á–∞—Å—Ç–Ω–∏–∫ —Å: {{ user.created_at[:10] if user.created_at else '–ù–µ–¥–∞–≤–Ω–æ' }}</p>
                    <a href="{{ url_for('logout') }}" class="btn btn-outline btn-block">–í—ã–π—Ç–∏</a>
                </div>
            </div>

            <div class="profile-main">
                <div class="achievements-card">
                    <h2>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-icon">üìö</div>
                            <div class="stat-content">
                                <div class="stat-number">{{ stats.lessons_completed if stats else 0 }}</div>
                                <div class="stat-label">–£—Ä–æ–∫–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                            </div>
                        </div>
                        
                        <div class="stat-item">
                            <div class="stat-icon">‚úÖ</div>
                            <div class="stat-content">
                                <div class="stat-number">{{ exercises_stats.exercises_completed if exercises_stats else 0 }}</div>
                                <div class="stat-label">–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–π –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
                            </div>
                        </div>
                        
                        <div class="stat-item">
                            <div class="stat-icon">üéØ</div>
                            <div class="stat-content">
                                <div class="stat-number">
                                    {% if exercises_stats and exercises_stats.exercises_completed > 0 %}
                                    {{ ((correct_stats.correct_answers / exercises_stats.exercises_completed) * 100)|round|int }}%
                                    {% else %}
                                    0%
                                    {% endif %}
                                </div>
                                <div class="stat-label">–¢–æ—á–Ω–æ—Å—Ç—å</div>
                            </div>
                        </div>
                        
                        <div class="stat-item">
                            <div class="stat-icon">üî•</div>
                            <div class="stat-content">
                                <div class="stat-number">{{ user.streak }}</div>
                                <div class="stat-label">–¢–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="progress-card">
                    <h2>–ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è</h2>
                    
                    <div class="progress-chart">
                        <div class="chart-header">
                            <h4>–ü—Ä–æ–≥—Ä–µ—Å—Å XP</h4>
                            <div class="xp-total">{{ user.xp }} XP</div>
                        </div>
                        
                        <div class="level-progress">
                            {% set levels = [
                                {'name': '–ù–æ–≤–∏—á–æ–∫', 'xp': 0},
                                {'name': '–°—Ä–µ–¥–Ω–∏–π', 'xp': 500},
                                {'name': '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π', 'xp': 1500},
                                {'name': '–≠–∫—Å–ø–µ—Ä—Ç', 'xp': 3000}
                            ] %}
                            
                            {% for level in levels %}
                            <div class="level-item {% if user.xp >= level.xp %}completed{% endif %}">
                                <div class="level-info">
                                    <div class="level-name">{{ level.name }}</div>
                                    <div class="level-xp">{{ level.xp }} XP</div>
                                </div>
                                <div class="level-status">
                                    {% if user.xp >= level.xp %}
                                    <span class="status-completed">‚úì –î–æ—Å—Ç–∏–≥–Ω—É—Ç</span>
                                    {% else %}
                                    <span class="status-pending">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <div class="recent-activity">
                    <h2>–ù–µ–¥–∞–≤–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</h2>
                    
                    <div class="activity-list">
                        {% if recent_lessons %}
                            {% for lesson in recent_lessons %}
                            <div class="activity-item">
                                <div class="activity-icon">üéØ</div>
                                <div class="activity-content">
                                    <div class="activity-text">–ó–∞–≤–µ—Ä—à–µ–Ω —É—Ä–æ–∫ <strong>{{ lesson.title }}</strong></div>
                                    <div class="activity-time">{{ lesson.completed_at[:10] }} ‚Ä¢ –û—Ü–µ–Ω–∫–∞: {{ lesson.score }}%</div>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="activity-item">
                                <div class="activity-icon">üìö</div>
                                <div class="activity-content">
                                    <div class="activity-text">–ù–∞—á–Ω–∏—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫!</div>
                                    <div class="activity-time">–ï—â–µ –Ω–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —É—Ä–æ–∫–æ–≤</div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º–∏, —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç—ã –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã */
.profile-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    padding: 3rem 0 2rem;
    text-align: center;
}

.profile-header h1 {
    margin-bottom: 0.5rem;
}

.profile-content {
    padding: 2rem 0;
}

.profile-grid {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 2rem;
}

.profile-card {
    background: var(--white);
    border-radius: 16px;
    padding: 2rem;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    margin-bottom: 1.5rem;
}

.profile-avatar {
    margin-bottom: 1rem;
}

.avatar-placeholder {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: var(--primary-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    font-weight: bold;
    margin: 0 auto;
}

.profile-info h2 {
    margin-bottom: 0.5rem;
    color: var(--text-dark);
}

.profile-email {
    color: var(--text-light);
    margin-bottom: 1.5rem;
}

.profile-stats {
    display: flex;
    justify-content: space-around;
}

.profile-stat {
    text-align: center;
}

.profile-stat strong {
    display: block;
    font-size: 1.5rem;
    color: var(--primary-color);
    margin-bottom: 0.25rem;
}

.profile-stat span {
    color: var(--text-light);
    font-size: 0.875rem;
}

.languages-card, .account-card {
    background: var(--white);
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    margin-bottom: 1.5rem;
}

.languages-card h3, .account-card h3 {
    margin-bottom: 1rem;
    color: var(--text-dark);
}

.language-item {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--border-color);
}

.language-item:last-child {
    border-bottom: none;
}

.achievements-card, .progress-card, .recent-activity {
    background: var(--white);
    border-radius: 16px;
    padding: 2rem;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    margin-bottom: 2rem;
}

.achievements-card h2, .progress-card h2, .recent-activity h2 {
    margin-bottom: 1.5rem;
    color: var(--text-dark);
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
}

.stat-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    background: var(--background-light);
    border-radius: 12px;
}

.stat-icon {
    font-size: 2rem;
}

.stat-number {
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--primary-color);
    margin-bottom: 0.25rem;
}

.stat-label {
    color: var(--text-light);
    font-size: 0.875rem;
}

.chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.xp-total {
    font-size: 1.25rem;
    font-weight: bold;
    color: var(--primary-color);
}

.level-progress {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.level-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    border-radius: 8px;
    background: var(--background-light);
}

.level-item.completed {
    background: linear-gradient(135deg, #d4edda, #c3e6cb);
}

.level-info {
    display: flex;
    gap: 1rem;
    align-items: center;
}

.level-name {
    font-weight: 600;
    color: var(--text-dark);
}

.level-xp {
    color: var(--text-light);
    font-size: 0.875rem;
}

.status-completed {
    color: var(--primary-color);
    font-weight: 600;
}

.status-pending {
    color: var(--text-light);
}

.activity-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.activity-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--background-light);
    border-radius: 8px;
}

.activity-icon {
    font-size: 1.25rem;
}

.activity-content {
    flex: 1;
}

.activity-text {
    margin-bottom: 0.25rem;
    color: var(--text-dark);
}

.activity-time {
    color: var(--text-light);
    font-size: 0.875rem;
}

@media (max-width: 768px) {
    .profile-grid {
        grid-template-columns: 1fr;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .profile-stats {
        justify-content: space-around;
    }
}
</style>
{% endblock %}